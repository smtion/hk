<?php if ( ! defined('BASEPATH')) exit('No direct script access allowed');
  
Class Date
{ 
  private static $_holydays = 
    array('2016-01-01', '2016-02-08', '2016-02-09', '2016-02-10', '2016-03-01', '2016-04-13', '2016-05-05', '2016-06-06', '2016-08-15', '2016-09-14', '2016-09-15', '2016-09-16', '2016-10-03'
        , '2017-01-27', '2017-01-30', '2017-03-01', '2017-05-01', '2017-05-05', '2017-05-03', '2017-06-06', '2017-08-15', '2017-10-03', '2017-10-04', '2017-10-05', '2017-10-06', '2017-10-03', '2017-10-09', '2017-12-20', '2017-12-25'
        , '2018-01-01', '2018-02-16', '2018-02-19', '2018-03-01', '2018-05-01', '2018-05-07', '2018-05-23', '2018-06-06', '2018-06-13', '2018-08-15', '2018-09-24', '2018-09-25', '2018-09-26', '2018-10-03', '2018-10-09', '2018-12-25'
        , '2019-01-01', '2019-02-05', '2019-02-06', '2019-02-07', '2019-03-01', '2019-05-01', '2019-05-06', '2019-05-13', '2019-06-06', '2019-08-15', '2019-09-13', '2019-09-16', '2019-10-03', '2019-10-09', '2019-12-25'
        , '2020-01-01', '2020-01-27', '2020-01-28', '2020-05-01', '2020-05-05', '2020-05-01', '2020-10-01', '2020-10-02', '2020-10-09', '2020-12-25'
        , '2021-01-01', '2021-02-12', '2021-02-15', '2021-03-01', '2021-05-05', '2021-05-20', '2021-09-21', '2021-09-22', '2021-09-23'
        , '2022-02-01', '2022-02-02', '2022-02-03', '2022-03-01', '2022-05-05', '2022-05-09', '2022-06-06', '2022-08-15', '2022-09-12', '2022-09-13', '2022-10-03'
        , '2023-01-23', '2023-01-24', '2023-01-25', '2023-03-01', '2023-05-01', '2023-05-05', '2023-06-06', '2023-08-15', '2023-09-29', '2023-10-02', '2023-10-03', '2023-10-09', '2023-12-25'
        , '2024-01-01', '2024-02-12', '2024-02-13', '2024-03-01', '2024-05-01', '2024-05-06', '2024-05-16', '2024-06-06', '2024-08-15', '2024-09-17', '2024-09-18', '2024-09-19', '2024-10-03', '2024-10-09', '2024-12-25'
        , '2025-01-01', '2025-01-29', '2025-01-30', '2025-01-31', '2025-05-01', '2025-05-05', '2025-05-06', '2025-06-06', '2025-08-15', '2025-10-06', '2025-10-07', '2025-10-08', '2025-10-03', '2025-10-09', '2025-12-25');
  
  public static function _checkHoliday($date) {
    $w = date('w', strtotime($date));
    $offset = 1;
    if ($w == 6) {
      $offset++;
    }
    
    if ($w == 0 || $w == 6 || in_array($date, self::$_holydays)) {
      $d = date('Y-m-d', strtotime("+$offset day", strtotime($date)));
      $date = CALC::_checkHoliday($d);
    }
    return $date;
  }
  
  public static function getToday() {
    return date('Y-m-d');
  }
  
  public static function isHolyday($date) {
    $w = date('w', strtotime($date));
    if ($w == 0 || $w == 6 || in_array($date, self::$_holydays)) return TRUE;
    else FALSE;
  }
  
  public static function getDiffDate($date, $diff) {
    if ($diff == 0) return $date;
    
    $d = date('Y-m-d', strtotime("+1 day", strtotime($date)));
    $w = date('w', strtotime($d));
    
    if ($w != 0 && $w != 6 && !in_array($d, self::$_holydays)) {
      $diff--;
    }
  
    return self::getDiffDate($d, $diff);
  }
  
  /**
   * @param string $birthdate 생년월일 8자리 (e.g. 19801020)
   * @param boolean $flag TRUE=만나이, FALSE=연나이(한국나이)
   * @return int
   */
  public static function getAge($birthdate, $flag = FALSE) {
    $age = date('Y') - substr($birthdate, 0, 4);
     
    return $flag? (strcmp(substr($birthdate, 4, 4), date('md')) <= 0? $age: $age - 1): $age + 1;
  }
  
  public static function getDoY($year) {
    return date('z', mktime(0, 0, 0, 12, 31, $year)) + 1;
  }
}